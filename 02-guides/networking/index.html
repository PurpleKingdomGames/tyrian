<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>Networking</title>
  
  
  <meta name="description" content="Elm-inspired Scala web UI library."/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/png" href="../../img/favicon.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="../../helium/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../../helium/laika-helium.css" />
    <link rel="stylesheet" type="text/css" href="../../css/custom.css" />
  <script src="../../helium/laika-helium.js"></script>
    <script src="../guided-tour.md.js"></script>
    <script src="../subs.md.js"></script>
    <script src="../networking.md.js"></script>
    <script src="../ssr.md.js"></script>
    <script src="../html.md.js"></script>
    <script src="../cmd.md.js"></script>
    <script src="../goodies.md.js"></script>
    <script src="../mdoc.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="image-link" href="../../"><img src="../../img/tyrian-horizontal.svg" alt="Homepage" title="Tyrian" width="150" height="50"></a>

  <div class="row links">
    
    <a class="button-link" href="https://discord.gg/b5CD47g">Discord</a>
    
    <a class="button-link" href="/api">API</a>
    
    <a class="button-link" href="https://github.com/PurpleKingdomGames/tyrian">Github</a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="button-link" href="https://discord.gg/b5CD47g">Discord</a>
    
    <a class="button-link" href="/api">API</a>
    
    <a class="button-link" href="https://github.com/PurpleKingdomGames/tyrian">Github</a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../../table-of-content/">Contents</a></li>
    <li class="level1 nav-header">Setup &amp; Configuration</li>
    <li class="level2 nav-leaf"><a href="../../01-installation/quickstart/">Installation</a></li>
    <li class="level1 nav-header">Guides</li>
    <li class="level2 nav-leaf"><a href="../bundling/">Building &amp; Bundling</a></li>
    <li class="level2 nav-leaf"><a href="../cmd/">Commands &amp; Effects</a></li>
    <li class="level2 nav-leaf"><a href="../goodies/">&quot;Built-in Goodies&quot;</a></li>
    <li class="level2 nav-leaf"><a href="../guided-tour/">Guided Example</a></li>
    <li class="level2 nav-leaf"><a href="../html/">Rendering HTML</a></li>
    <li class="level2 active nav-leaf"><a href="#">Networking</a></li>
    <li class="level2 nav-leaf"><a href="../routing/">Frontend Routing</a></li>
    <li class="level2 nav-leaf"><a href="../ssr/">Server-side Rendering &amp; HTMX</a></li>
    <li class="level2 nav-leaf"><a href="../subs/">Subscriptions</a></li>
    <li class="level2 nav-leaf"><a href="../tyrian-indigo-bridge/">Tyrian-Indigo Bridge</a></li>
    <li class="level1 nav-header">Architecture</li>
    <li class="level2 nav-leaf"><a href="../../03-architecture/the-elm-architecture/">The Elm Architecture</a></li>
    <li class="level2 nav-leaf"><a href="../../03-architecture/tyrian-and-indigo/">Tyrian &amp; Indigo</a></li>
    <li class="level2 nav-leaf"><a href="../../03-architecture/tyrian-vs-elm/">Tyrian vs Elm</a></li>
    <li class="level1 nav-header">Examples</li>
    <li class="level2 nav-leaf"><a href="../../04-examples/examples/">Examples</a></li>
    <li class="level1 nav-header">Information &amp; Trivia</li>
    <li class="level2 nav-leaf"><a href="../../05-information/discussion/">Discussion</a></li>
    <li class="level2 nav-leaf"><a href="../../05-information/provenance/">Provenance &amp; Thanks</a></li>
    <li class="level2 nav-leaf"><a href="../../05-information/tyrian-purple/">Tyrian Purple</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">Networking</a></p>

  <ul class="nav-list">
    <li class="level1 nav-node"><a href="#http">Http</a></li>
    <li class="level2 nav-leaf"><a href="#fetch-random-gif-via-http">Fetch random GIF via HTTP</a></li>
    <li class="level2 nav-leaf"><a href="#http4s-dom-integration">Http4s-dom integration</a></li>
    <li class="level1 nav-node"><a href="#web-sockets">Web Sockets</a></li>
    <li class="level2 nav-leaf"><a href="#ws-echo-server">WS echo server</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="networking" class="title">Networking</h1>
        <p>Out of the box, Tyrian supports two flavors of networking, <a href="https://github.com/PurpleKingdomGames/tyrian/tree/main/examples">HTTP and Web Sockets</a>, and we have examples you can run of both. Please see the instructions in the README file.</p>
        <p>It should be said that both implementations are quite primitive at the time of writing. Contributions in the form of issues and improvements are very welcome in this area. No doubt they will be improved as the need arises.</p>
        
        <h2 id="http" class="section"><a class="anchor-link left" href="#http"><i class="icofont-laika link">&#xef71;</i></a>Http</h2>
        <p><code>tyrian.http.Http</code> is a built-in <code>Cmd</code> that defines the following method:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">object</span><span> </span><span class="type-name">Http</span><span>:
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">send</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>]: </span><span class="type-name">Async</span><span>, </span><span class="type-name">A</span><span>, </span><span class="type-name">Msg</span><span>](
    </span><span class="identifier">request</span><span>: </span><span class="type-name">Request</span><span>[</span><span class="type-name">A</span><span>],
    </span><span class="identifier">resultToMessage</span><span>: </span><span class="type-name">Decoder</span><span>[</span><span class="type-name">Msg</span><span>]
  ): </span><span class="type-name">Cmd</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Msg</span><span>]</span></code></pre>
        <p>Additionally, Tyrian also integrates with <a href="https://github.com/http4s/http4s-dom">http4s-dom</a>.</p>
        
        <h3 id="fetch-random-gif-via-http" class="section"><a class="anchor-link left" href="#fetch-random-gif-via-http"><i class="icofont-laika link">&#xef71;</i></a>Fetch random GIF via HTTP</h3>
        <p>Assuming the following imports:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="type-name">IO</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">either</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="type-name">HCursor</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="identifier">parser</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">tyrian</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">tyrian</span><span>.</span><span class="identifier">cmds</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">tyrian</span><span>.</span><span class="identifier">http</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">tyrian</span><span>.</span><span class="type-name">Html</span><span>.*</span></code></pre>
        <p>Let&#39;s walk through this example starting with the <code>Model1</code> and <code>Msg1</code> types.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Model1</span><span>(</span><span class="identifier">topic</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">gifUrl</span><span>: </span><span class="type-name">String</span><span>)

</span><span class="identifier">enum</span><span> </span><span class="type-name">Msg1</span><span>:
  </span><span class="keyword">case</span><span> </span><span class="type-name">MorePlease</span><span>              </span><span class="keyword">extends</span><span> </span><span class="type-name">Msg1</span><span>
  </span><span class="keyword">case</span><span> </span><span class="type-name">NewGif</span><span>(</span><span class="identifier">result</span><span>: </span><span class="type-name">String</span><span>)  </span><span class="keyword">extends</span><span> </span><span class="type-name">Msg1</span><span>
  </span><span class="keyword">case</span><span> </span><span class="type-name">GifError</span><span>(</span><span class="identifier">error</span><span>: </span><span class="type-name">String</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">Msg1</span></code></pre>
        <p>Followed by a <code>Decoder[Msg1]</code> needed to parse the HTTP responses.</p>
        <pre><code class="nohighlight"><span class="keyword">object</span><span> </span><span class="type-name">Msg1</span><span>:
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">jsonDecode</span><span>(</span><span class="identifier">hcursor</span><span>: </span><span class="type-name">HCursor</span><span>) =
    </span><span class="identifier">hcursor</span><span>
      .</span><span class="identifier">downField</span><span>(</span><span class="string-literal">&quot;data&quot;</span><span>)
      .</span><span class="identifier">downField</span><span>(</span><span class="string-literal">&quot;images&quot;</span><span>)
      .</span><span class="identifier">downField</span><span>(</span><span class="string-literal">&quot;downsized_medium&quot;</span><span>)
      .</span><span class="identifier">get</span><span>[</span><span class="type-name">String</span><span>](</span><span class="string-literal">&quot;url&quot;</span><span>)
      .</span><span class="identifier">toOption</span><span>
      .</span><span class="identifier">toRight</span><span>(</span><span class="string-literal">&quot;wrong json format&quot;</span><span>)

  </span><span class="keyword">private</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">onResponse</span><span>: </span><span class="type-name">Response</span><span> =&gt; </span><span class="type-name">Msg1</span><span> = { </span><span class="identifier">response</span><span> =&gt;
    </span><span class="identifier">parse</span><span>(</span><span class="identifier">response</span><span>.</span><span class="identifier">body</span><span>)
      .</span><span class="identifier">leftMap</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">message</span><span>)
      .</span><span class="identifier">flatMap</span><span>(</span><span class="identifier">j</span><span> =&gt; </span><span class="identifier">jsonDecode</span><span>(</span><span class="identifier">j</span><span>.</span><span class="identifier">hcursor</span><span>))
      .</span><span class="identifier">fold</span><span>(</span><span class="type-name">Msg1</span><span>.</span><span class="type-name">GifError</span><span>(</span><span class="identifier">_</span><span>), </span><span class="type-name">Msg1</span><span>.</span><span class="type-name">NewGif</span><span>(</span><span class="identifier">_</span><span>))
  }

  </span><span class="keyword">private</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">onError</span><span>: </span><span class="type-name">HttpError</span><span> =&gt; </span><span class="type-name">Msg1</span><span> =
    </span><span class="identifier">e</span><span> =&gt; </span><span class="type-name">Msg1</span><span>.</span><span class="type-name">GifError</span><span>(</span><span class="identifier">e</span><span>.</span><span class="identifier">toString</span><span>)

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">fromHttpResponse</span><span>: </span><span class="type-name">Decoder</span><span>[</span><span class="type-name">Msg1</span><span>] =
    </span><span class="type-name">Decoder</span><span>[</span><span class="type-name">Msg1</span><span>](</span><span class="identifier">onResponse</span><span>, </span><span class="identifier">onError</span><span>)</span></code></pre>
        <p>Next we have an <code>HttpHelper</code> that invokes the <code>Http.send</code> method using Giphy&#39;s API.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">object</span><span> </span><span class="type-name">HttpHelper</span><span>:
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">url</span><span>(</span><span class="identifier">topic</span><span>: </span><span class="type-name">String</span><span>) =
    </span><span class="string-literal">s&quot;https://api.giphy.com/v1/gifs/random?api_key=dc6zaTOxFJmzC&amp;tag=</span><span class="substitution">$topic</span><span class="string-literal">&quot;</span><span>

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">getRandomGif</span><span>(</span><span class="identifier">topic</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Cmd</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Msg1</span><span>] =
    </span><span class="type-name">Http</span><span>.</span><span class="identifier">send</span><span>(</span><span class="type-name">Request</span><span>.</span><span class="identifier">get</span><span>(</span><span class="identifier">url</span><span>(</span><span class="identifier">topic</span><span>)), </span><span class="type-name">Msg1</span><span>.</span><span class="identifier">fromHttpResponse</span><span>)</span></code></pre>
        <p>Ultimately, we can use it in our <code>init</code> and <code>update</code> methods, or anywhere where a <code>Cmd[IO, Msg1]</code> is expected. For example:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">object</span><span> </span><span class="type-name">HttpMain</span><span>:
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">init</span><span>(</span><span class="identifier">flags</span><span>: </span><span class="type-name">Map</span><span>[</span><span class="type-name">String</span><span>, </span><span class="type-name">String</span><span>]): (</span><span class="type-name">Model1</span><span>, </span><span class="type-name">Cmd</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Msg1</span><span>]) =
    (</span><span class="type-name">Model1</span><span>(</span><span class="string-literal">&quot;cats&quot;</span><span>, </span><span class="string-literal">&quot;waiting.gif&quot;</span><span>), </span><span class="type-name">HttpHelper</span><span>.</span><span class="identifier">getRandomGif</span><span>(</span><span class="string-literal">&quot;cats&quot;</span><span>))

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">update</span><span>(</span><span class="identifier">model</span><span>: </span><span class="type-name">Model1</span><span>): </span><span class="type-name">Msg1</span><span> =&gt; (</span><span class="type-name">Model1</span><span>, </span><span class="type-name">Cmd</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Msg1</span><span>]) =
    </span><span class="keyword">case</span><span> </span><span class="type-name">Msg1</span><span>.</span><span class="type-name">MorePlease</span><span>     =&gt; (</span><span class="identifier">model</span><span>, </span><span class="type-name">HttpHelper</span><span>.</span><span class="identifier">getRandomGif</span><span>(</span><span class="identifier">model</span><span>.</span><span class="identifier">topic</span><span>))
    </span><span class="keyword">case</span><span> </span><span class="type-name">Msg1</span><span>.</span><span class="type-name">NewGif</span><span>(</span><span class="identifier">newUrl</span><span>) =&gt; (</span><span class="identifier">model</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">gifUrl</span><span> = </span><span class="identifier">newUrl</span><span>), </span><span class="type-name">Cmd</span><span>.</span><span class="type-name">None</span><span>)
    </span><span class="keyword">case</span><span> </span><span class="type-name">Msg1</span><span>.</span><span class="type-name">GifError</span><span>(</span><span class="identifier">_</span><span>)    =&gt; (</span><span class="identifier">model</span><span>, </span><span class="type-name">Cmd</span><span>.</span><span class="type-name">None</span><span>)</span></code></pre>
        <p>&lt;div id=&quot;mdoc-html-run4&quot; data-mdoc-js&gt;&lt;/div&gt;</p>
        <p>You can find the full code on the examples directory linked at the top.</p>
        
        <h3 id="http4s-dom-integration" class="section"><a class="anchor-link left" href="#http4s-dom-integration"><i class="icofont-laika link">&#xef71;</i></a>Http4s-dom integration</h3>
        <p>To use <code>http4s-dom</code> instead, we only need to replace the <code>HttpHelper</code> with the following implementation.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">circe</span><span>.{ </span><span class="type-name">Decoder</span><span> </span><span class="identifier">as</span><span> </span><span class="type-name">JsonDecoder</span><span>, </span><span class="type-name">DecodingFailure</span><span> }
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="type-name">CirceEntityCodec</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">dom</span><span>.</span><span class="type-name">FetchClientBuilder</span><span>

</span><span class="keyword">object</span><span> </span><span class="type-name">Http4sDomHelper</span><span>:
  </span><span class="keyword">private</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">client</span><span> = </span><span class="type-name">FetchClientBuilder</span><span>[</span><span class="type-name">IO</span><span>].</span><span class="identifier">create</span><span>

  </span><span class="identifier">given</span><span> </span><span class="type-name">JsonDecoder</span><span>[</span><span class="type-name">Msg1</span><span>] = </span><span class="type-name">JsonDecoder</span><span>.</span><span class="identifier">instance</span><span> { </span><span class="identifier">c</span><span> =&gt;
    </span><span class="type-name">Msg1</span><span>.</span><span class="identifier">jsonDecode</span><span>(</span><span class="identifier">c</span><span>).</span><span class="identifier">map</span><span>(</span><span class="type-name">Msg1</span><span>.</span><span class="type-name">NewGif</span><span>(</span><span class="identifier">_</span><span>)).</span><span class="identifier">leftMap</span><span>(</span><span class="identifier">e</span><span> =&gt; </span><span class="type-name">DecodingFailure</span><span>(</span><span class="identifier">e</span><span>, </span><span class="identifier">c</span><span>.</span><span class="identifier">history</span><span>))
  }

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">getRandomGif</span><span>(</span><span class="identifier">topic</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Cmd</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Msg1</span><span>] =
    </span><span class="keyword">val</span><span> </span><span class="identifier">fetchGif</span><span>: </span><span class="type-name">IO</span><span>[</span><span class="type-name">Msg1</span><span>] =
      </span><span class="identifier">client</span><span>
        .</span><span class="identifier">expect</span><span>[</span><span class="type-name">Msg1</span><span>](</span><span class="type-name">HttpHelper</span><span>.</span><span class="identifier">url</span><span>(</span><span class="identifier">topic</span><span>))
        .</span><span class="identifier">handleError</span><span>(</span><span class="identifier">e</span><span> =&gt; </span><span class="type-name">Msg1</span><span>.</span><span class="type-name">GifError</span><span>(</span><span class="identifier">e</span><span>.</span><span class="identifier">getMessage</span><span>))

    </span><span class="type-name">Cmd</span><span>.</span><span class="type-name">Run</span><span>(</span><span class="identifier">fetchGif</span><span>)</span></code></pre>
        <p>&lt;div id=&quot;mdoc-html-run5&quot; data-mdoc-js&gt;&lt;/div&gt;</p>
        
        <h2 id="web-sockets" class="section"><a class="anchor-link left" href="#web-sockets"><i class="icofont-laika link">&#xef71;</i></a>Web Sockets</h2>
        <p>Another built-in command is <code>tyrian.websocket.WebSocket</code>, which has a more complex API.</p>
        <pre><code class="nohighlight"><span class="keyword">final</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">WebSocket</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>]: </span><span class="type-name">Async</span><span>](</span><span class="identifier">liveSocket</span><span>: </span><span class="type-name">LiveSocket</span><span>[</span><span class="type-name">F</span><span>]):
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">disconnect</span><span>[</span><span class="type-name">Msg</span><span>]: </span><span class="type-name">Cmd</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Msg</span><span>]
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">publish</span><span>[</span><span class="type-name">Msg</span><span>](</span><span class="identifier">message</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Cmd</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Msg</span><span>]
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">subscribe</span><span>[</span><span class="type-name">Msg</span><span>](</span><span class="identifier">f</span><span>: </span><span class="type-name">WebSocketEvent</span><span> =&gt; </span><span class="type-name">Msg</span><span>): </span><span class="type-name">Sub</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Msg</span><span>]

</span><span class="comment">/** The running instance of the WebSocket */</span><span>
</span><span class="keyword">final</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">LiveSocket</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>]: </span><span class="type-name">Async</span><span>](</span><span class="keyword">val</span><span> </span><span class="identifier">socket</span><span>: </span><span class="identifier">dom</span><span>.</span><span class="type-name">WebSocket</span><span>, </span><span class="keyword">val</span><span> </span><span class="identifier">subs</span><span>: </span><span class="type-name">Sub</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">WebSocketEvent</span><span>])

</span><span class="keyword">object</span><span> </span><span class="type-name">WebSocket</span><span>:
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">connect</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>]: </span><span class="type-name">Async</span><span>, </span><span class="type-name">Msg</span><span>](
    </span><span class="identifier">address</span><span>: </span><span class="type-name">String</span><span>,
    </span><span class="identifier">onOpenMessage</span><span>: </span><span class="type-name">String</span><span>,
    </span><span class="identifier">keepAliveSettings</span><span>: </span><span class="type-name">KeepAliveSettings</span><span>
  )(
    </span><span class="identifier">resultToMessage</span><span>: </span><span class="type-name">WebSocketConnect</span><span>[</span><span class="type-name">F</span><span>] =&gt; </span><span class="type-name">Msg</span><span>
  ): </span><span class="type-name">Cmd</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Msg</span><span>]</span></code></pre>
        <p>Having a <code>WebSocket</code> instance allows us to <code>publish</code> messages (<code>Cmd[F, Msg]</code>), <code>subscribe</code> to events (<code>Sub[F, Msg]</code>), and explicitly <code>disconnect</code> (another <code>Cmd[F, Msg]</code>) from the server. To initiate a connection, we can use any of the available <code>connect</code> methods defined on its companion object.</p>
        
        <h3 id="ws-echo-server" class="section"><a class="anchor-link left" href="#ws-echo-server"><i class="icofont-laika link">&#xef71;</i></a>WS echo server</h3>
        <p>The following example demonstrates the usage of <code>WebSocket</code>, starting with the following imports:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="type-name">IO</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">tyrian</span><span>.</span><span class="type-name">Html</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">tyrian</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">tyrian</span><span>.</span><span class="identifier">cmds</span><span>.</span><span class="type-name">Logger</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">tyrian</span><span>.</span><span class="identifier">websocket</span><span>.*</span></code></pre>
        <p>Next we have the <code>Msg</code> and <code>Model</code> types.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">enum</span><span> </span><span class="type-name">Msg</span><span>:
  </span><span class="keyword">case</span><span> </span><span class="type-name">FromSocket</span><span>(</span><span class="identifier">message</span><span>: </span><span class="type-name">String</span><span>)
  </span><span class="keyword">case</span><span> </span><span class="type-name">ToSocket</span><span>(</span><span class="identifier">message</span><span>: </span><span class="type-name">String</span><span>)
  </span><span class="keyword">case</span><span> </span><span class="type-name">WebSocketStatus</span><span>(</span><span class="identifier">status</span><span>: </span><span class="type-name">EchoSocket</span><span>.</span><span class="type-name">Status</span><span>)

</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Model</span><span>(</span><span class="identifier">echoSocket</span><span>: </span><span class="type-name">EchoSocket</span><span>, </span><span class="identifier">log</span><span>: </span><span class="type-name">List</span><span>[</span><span class="type-name">String</span><span>])

</span><span class="keyword">object</span><span> </span><span class="type-name">Model</span><span>:
  </span><span class="keyword">val</span><span> </span><span class="identifier">init</span><span>: </span><span class="type-name">Model</span><span> =
    </span><span class="type-name">Model</span><span>(</span><span class="type-name">EchoSocket</span><span>.</span><span class="identifier">init</span><span>, </span><span class="type-name">Nil</span><span>)</span></code></pre>
        <p>Followed by a custom <code>EchoSocket</code> class that handles the connection by reacting to <code>EchoSocket.Status</code> messages. The handling of the <code>Connecting</code> message is of particular interest, as it initiates the socket connection via <code>WebSocket.connect</code>, including keep-alive settings.</p>
        <pre><code class="nohighlight"><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">EchoSocket</span><span>(</span><span class="identifier">socketUrl</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">socket</span><span>: </span><span class="type-name">Option</span><span>[</span><span class="type-name">WebSocket</span><span>[</span><span class="type-name">IO</span><span>]]):

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">connectDisconnectButton</span><span> =
    </span><span class="keyword">if</span><span> </span><span class="identifier">socket</span><span>.</span><span class="identifier">nonEmpty</span><span> </span><span class="identifier">then</span><span>
      </span><span class="identifier">button</span><span>(</span><span class="identifier">onClick</span><span>(</span><span class="type-name">EchoSocket</span><span>.</span><span class="type-name">Status</span><span>.</span><span class="type-name">Disconnecting</span><span>.</span><span class="identifier">asMsg</span><span>))(</span><span class="string-literal">&quot;Disconnect&quot;</span><span>)
    </span><span class="keyword">else</span><span> </span><span class="identifier">button</span><span>(</span><span class="identifier">onClick</span><span>(</span><span class="type-name">EchoSocket</span><span>.</span><span class="type-name">Status</span><span>.</span><span class="type-name">Connecting</span><span>.</span><span class="identifier">asMsg</span><span>))(</span><span class="string-literal">&quot;Connect&quot;</span><span>)

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">update</span><span>(</span><span class="identifier">status</span><span>: </span><span class="type-name">EchoSocket</span><span>.</span><span class="type-name">Status</span><span>): (</span><span class="type-name">EchoSocket</span><span>, </span><span class="type-name">Cmd</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Msg</span><span>]) =
    </span><span class="identifier">status</span><span> </span><span class="keyword">match</span><span>
      </span><span class="keyword">case</span><span> </span><span class="type-name">EchoSocket</span><span>.</span><span class="type-name">Status</span><span>.</span><span class="type-name">ConnectionError</span><span>(</span><span class="identifier">err</span><span>) =&gt;
        (</span><span class="keyword">this</span><span>, </span><span class="type-name">Logger</span><span>.</span><span class="identifier">error</span><span>(</span><span class="string-literal">s&quot;Failed to open WebSocket connection: </span><span class="substitution">$err</span><span class="string-literal">&quot;</span><span>))

      </span><span class="keyword">case</span><span> </span><span class="type-name">EchoSocket</span><span>.</span><span class="type-name">Status</span><span>.</span><span class="type-name">Connected</span><span>(</span><span class="identifier">ws</span><span>) =&gt;
        (</span><span class="keyword">this</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">socket</span><span> = </span><span class="type-name">Some</span><span>(</span><span class="identifier">ws</span><span>)), </span><span class="type-name">Cmd</span><span>.</span><span class="type-name">None</span><span>)

      </span><span class="keyword">case</span><span> </span><span class="type-name">EchoSocket</span><span>.</span><span class="type-name">Status</span><span>.</span><span class="type-name">Connecting</span><span> =&gt;
        </span><span class="keyword">val</span><span> </span><span class="identifier">connect</span><span> =
          </span><span class="type-name">WebSocket</span><span>.</span><span class="identifier">connect</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Msg</span><span>](
            </span><span class="identifier">address</span><span> = </span><span class="identifier">socketUrl</span><span>,
            </span><span class="identifier">onOpenMessage</span><span> = </span><span class="string-literal">&quot;Connect me!&quot;</span><span>,
            </span><span class="identifier">keepAliveSettings</span><span> = </span><span class="type-name">KeepAliveSettings</span><span>.</span><span class="keyword">default</span><span>
          ) {
            </span><span class="keyword">case</span><span> </span><span class="type-name">WebSocketConnect</span><span>.</span><span class="type-name">Error</span><span>(</span><span class="identifier">err</span><span>) =&gt;
              </span><span class="type-name">EchoSocket</span><span>.</span><span class="type-name">Status</span><span>.</span><span class="type-name">ConnectionError</span><span>(</span><span class="identifier">err</span><span>).</span><span class="identifier">asMsg</span><span>

            </span><span class="keyword">case</span><span> </span><span class="type-name">WebSocketConnect</span><span>.</span><span class="type-name">Socket</span><span>(</span><span class="identifier">ws</span><span>) =&gt;
              </span><span class="type-name">EchoSocket</span><span>.</span><span class="type-name">Status</span><span>.</span><span class="type-name">Connected</span><span>(</span><span class="identifier">ws</span><span>).</span><span class="identifier">asMsg</span><span>
          }

        (</span><span class="keyword">this</span><span>, </span><span class="identifier">connect</span><span>)

      </span><span class="keyword">case</span><span> </span><span class="type-name">EchoSocket</span><span>.</span><span class="type-name">Status</span><span>.</span><span class="type-name">Disconnecting</span><span> =&gt;
        </span><span class="keyword">val</span><span> </span><span class="identifier">log</span><span> = </span><span class="type-name">Logger</span><span>.</span><span class="identifier">info</span><span>[</span><span class="type-name">IO</span><span>](</span><span class="string-literal">&quot;Graceful shutdown of EchoSocket connection&quot;</span><span>)
        </span><span class="keyword">val</span><span> </span><span class="identifier">cmds</span><span> =
          </span><span class="identifier">socket</span><span>.</span><span class="identifier">map</span><span>(</span><span class="identifier">ws</span><span> =&gt; </span><span class="type-name">Cmd</span><span>.</span><span class="type-name">Batch</span><span>(</span><span class="identifier">log</span><span>, </span><span class="identifier">ws</span><span>.</span><span class="identifier">disconnect</span><span>)).</span><span class="identifier">getOrElse</span><span>(</span><span class="identifier">log</span><span>)

        (</span><span class="keyword">this</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">socket</span><span> = </span><span class="type-name">None</span><span>), </span><span class="identifier">cmds</span><span>)

      </span><span class="keyword">case</span><span> </span><span class="type-name">EchoSocket</span><span>.</span><span class="type-name">Status</span><span>.</span><span class="type-name">Disconnected</span><span> =&gt;
        (</span><span class="keyword">this</span><span>, </span><span class="type-name">Logger</span><span>.</span><span class="identifier">info</span><span>(</span><span class="string-literal">&quot;WebSocket not connected yet&quot;</span><span>))

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">publish</span><span>(</span><span class="identifier">message</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Cmd</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Msg</span><span>] =
    </span><span class="identifier">socket</span><span>.</span><span class="identifier">map</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">publish</span><span>(</span><span class="identifier">message</span><span>)).</span><span class="identifier">getOrElse</span><span>(</span><span class="type-name">Cmd</span><span>.</span><span class="type-name">None</span><span>)

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">subscribe</span><span>(</span><span class="identifier">toMessage</span><span>: </span><span class="type-name">WebSocketEvent</span><span> =&gt; </span><span class="type-name">Msg</span><span>): </span><span class="type-name">Sub</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Msg</span><span>] =
    </span><span class="identifier">socket</span><span>.</span><span class="identifier">fold</span><span>(</span><span class="type-name">Sub</span><span>.</span><span class="identifier">emit</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Msg</span><span>](</span><span class="type-name">EchoSocket</span><span>.</span><span class="type-name">Status</span><span>.</span><span class="type-name">Disconnected</span><span>.</span><span class="identifier">asMsg</span><span>)) {
      </span><span class="identifier">_</span><span>.</span><span class="identifier">subscribe</span><span>(</span><span class="identifier">toMessage</span><span>)
    }

</span><span class="keyword">object</span><span> </span><span class="type-name">EchoSocket</span><span>:

  </span><span class="keyword">val</span><span> </span><span class="identifier">init</span><span>: </span><span class="type-name">EchoSocket</span><span> =
    </span><span class="type-name">EchoSocket</span><span>(</span><span class="string-literal">&quot;wss://ws.ifelse.io/&quot;</span><span>, </span><span class="type-name">None</span><span>)

  </span><span class="identifier">enum</span><span> </span><span class="type-name">Status</span><span>:
    </span><span class="keyword">case</span><span> </span><span class="type-name">Connecting</span><span>
    </span><span class="keyword">case</span><span> </span><span class="type-name">Connected</span><span>(</span><span class="identifier">ws</span><span>: </span><span class="type-name">WebSocket</span><span>[</span><span class="type-name">IO</span><span>])
    </span><span class="keyword">case</span><span> </span><span class="type-name">ConnectionError</span><span>(</span><span class="identifier">msg</span><span>: </span><span class="type-name">String</span><span>)
    </span><span class="keyword">case</span><span> </span><span class="type-name">Disconnecting</span><span>
    </span><span class="keyword">case</span><span> </span><span class="type-name">Disconnected</span><span>

    </span><span class="keyword">def</span><span> </span><span class="declaration-name">asMsg</span><span>: </span><span class="type-name">Msg</span><span> = </span><span class="type-name">Msg</span><span>.</span><span class="type-name">WebSocketStatus</span><span>(</span><span class="keyword">this</span><span>)</span></code></pre>
        <p>At last, we can see how to handle socket messages and status changes in our <code>update</code> method.</p>
        <pre><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">update</span><span>(</span><span class="identifier">model</span><span>: </span><span class="type-name">Model</span><span>): </span><span class="type-name">Msg</span><span> =&gt; (</span><span class="type-name">Model</span><span>, </span><span class="type-name">Cmd</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Msg</span><span>]) =
  </span><span class="keyword">case</span><span> </span><span class="type-name">Msg</span><span>.</span><span class="type-name">WebSocketStatus</span><span>(</span><span class="identifier">status</span><span>) =&gt;
    </span><span class="keyword">val</span><span> (</span><span class="identifier">nextWS</span><span>, </span><span class="identifier">cmds</span><span>) = </span><span class="identifier">model</span><span>.</span><span class="identifier">echoSocket</span><span>.</span><span class="identifier">update</span><span>(</span><span class="identifier">status</span><span>)
    (</span><span class="identifier">model</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">echoSocket</span><span> = </span><span class="identifier">nextWS</span><span>), </span><span class="identifier">cmds</span><span>)

  </span><span class="keyword">case</span><span> </span><span class="type-name">Msg</span><span>.</span><span class="type-name">FromSocket</span><span>(</span><span class="identifier">message</span><span>) =&gt;
    </span><span class="keyword">val</span><span> </span><span class="identifier">logWS</span><span> = </span><span class="type-name">Logger</span><span>.</span><span class="identifier">info</span><span>[</span><span class="type-name">IO</span><span>](</span><span class="string-literal">&quot;Got: &quot;</span><span> + </span><span class="identifier">message</span><span>)
    (</span><span class="identifier">model</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">log</span><span> = </span><span class="identifier">message</span><span> :: </span><span class="identifier">model</span><span>.</span><span class="identifier">log</span><span>), </span><span class="identifier">logWS</span><span>)

  </span><span class="keyword">case</span><span> </span><span class="type-name">Msg</span><span>.</span><span class="type-name">ToSocket</span><span>(</span><span class="identifier">message</span><span>) =&gt;
    </span><span class="keyword">val</span><span> </span><span class="identifier">cmds</span><span>: </span><span class="type-name">Cmd</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Msg</span><span>] =
      </span><span class="type-name">Cmd</span><span>.</span><span class="type-name">Batch</span><span>(
        </span><span class="type-name">Logger</span><span>.</span><span class="identifier">info</span><span>(</span><span class="string-literal">&quot;Sent: &quot;</span><span> + </span><span class="identifier">message</span><span>),
        </span><span class="identifier">model</span><span>.</span><span class="identifier">echoSocket</span><span>.</span><span class="identifier">publish</span><span>(</span><span class="identifier">message</span><span>)
      )

    (</span><span class="identifier">model</span><span>, </span><span class="identifier">cmds</span><span>)</span></code></pre>
        <p>&lt;div id=&quot;mdoc-html-run9&quot; data-mdoc-js&gt;&lt;/div&gt;</p>
        <p>Moreover, the <code>subscriptions</code> method handles Web Socket events.</p>
        <pre><code class="nohighlight"><span>  </span><span class="keyword">def</span><span> </span><span class="declaration-name">subscriptions</span><span>(</span><span class="identifier">model</span><span>: </span><span class="type-name">Model</span><span>): </span><span class="type-name">Sub</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Msg</span><span>] =
    </span><span class="identifier">model</span><span>.</span><span class="identifier">echoSocket</span><span>.</span><span class="identifier">subscribe</span><span> {
      </span><span class="keyword">case</span><span> </span><span class="type-name">WebSocketEvent</span><span>.</span><span class="type-name">Error</span><span>(</span><span class="identifier">errorMesage</span><span>) =&gt;
        </span><span class="type-name">Msg</span><span>.</span><span class="type-name">FromSocket</span><span>(</span><span class="identifier">errorMesage</span><span>)

      </span><span class="keyword">case</span><span> </span><span class="type-name">WebSocketEvent</span><span>.</span><span class="type-name">Receive</span><span>(</span><span class="identifier">message</span><span>) =&gt;
        </span><span class="type-name">Msg</span><span>.</span><span class="type-name">FromSocket</span><span>(</span><span class="identifier">message</span><span>)

      </span><span class="keyword">case</span><span> </span><span class="type-name">WebSocketEvent</span><span>.</span><span class="type-name">Open</span><span> =&gt;
        </span><span class="type-name">Msg</span><span>.</span><span class="type-name">FromSocket</span><span>(</span><span class="string-literal">&quot;&lt;no message - socket opened&gt;&quot;</span><span>)

      </span><span class="keyword">case</span><span> </span><span class="type-name">WebSocketEvent</span><span>.</span><span class="type-name">Close</span><span>(</span><span class="identifier">code</span><span>, </span><span class="identifier">reason</span><span>) =&gt;
        </span><span class="type-name">Msg</span><span>.</span><span class="type-name">FromSocket</span><span>(</span><span class="string-literal">s&quot;&lt;socket closed&gt; - code: </span><span class="substitution">$code</span><span class="string-literal">, reason: </span><span class="substitution">$reason</span><span class="string-literal">&quot;</span><span>)

      </span><span class="keyword">case</span><span> </span><span class="type-name">WebSocketEvent</span><span>.</span><span class="type-name">Heartbeat</span><span> =&gt;
        </span><span class="type-name">Msg</span><span>.</span><span class="type-name">ToSocket</span><span>(</span><span class="string-literal">&quot;&lt;💓 heartbeat 💓&gt;&quot;</span><span>)
    }</span></code></pre>
        <p>&lt;div id=&quot;mdoc-html-run10&quot; data-mdoc-js&gt;&lt;/div&gt;</p>
        <p>The full code can be found on the examples linked at the top. </p>
        <p>Furthermore, you may also find the <a href="https://github.com/gvolpe/trading/tree/main/modules/ws-client">trading project</a> useful: a full-stack application with a Web Socket client sharing the back-end domain model.
        &lt;script type=&quot;text/javascript&quot; src=&quot;networking.md.js&quot; defer&gt;&lt;/script&gt;
        &lt;script type=&quot;text/javascript&quot; src=&quot;mdoc.js&quot; defer&gt;&lt;/script&gt;</p>

        
<hr class="footer-rule"/>
<footer>
  Site generated by <a href="https://typelevel.org/Laika/">Laika</a> with the Helium theme.
</footer>


      </main>

    </div>

  </body>

</html>